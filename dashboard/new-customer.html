<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New Customer - Emily Bakes Cakes</title>
    <link rel="stylesheet" href="css/dashboard-redesigned.css">
    <script src="js/ux-enhancements.js"></script>
    <style>
        .form-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .form-section {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .section-title {
            color: #C44569;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #C44569;
            box-shadow: 0 0 0 3px rgba(196, 69, 105, 0.1);
        }

        .form-group textarea {
            grid-column: 1 / -1;
            resize: vertical;
            min-height: 100px;
        }

        .required-indicator {
            color: #EF4444;
            margin-left: 4px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
        }

        .btn-submit {
            background: #C44569;
            color: white;
            padding: 12px 32px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn-submit:hover {
            background: #a83a54;
        }

        .btn-reset {
            background: #f0f0f0;
            color: #333;
            padding: 12px 32px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn-reset:hover {
            background: #e0e0e0;
        }

        .btn-cancel {
            background: transparent;
            color: #C44569;
            padding: 12px 32px;
            border: 2px solid #C44569;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-cancel:hover {
            background: #C44569;
            color: white;
        }

        .help-text {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
        }

        @media (max-width: 768px) {
            .form-container {
                padding: 20px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }

            .btn-submit,
            .btn-reset,
            .btn-cancel {
                width: 100%;
            }
        }

        .success-message {
            display: none;
            background: #10B981;
            color: white;
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .error-message {
            display: none;
            background: #EF4444;
            color: white;
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="header-left">
            <div class="header-logo">
                <div class="logo-text">Emily Bakes Cakes</div>
            </div>
        </div>
        <div class="header-center">
            <div class="header-user">
                <div class="role-badge" id="staff-role">Staff</div>
                <div class="manager-name" id="staff-name">Loading...</div>
            </div>
        </div>
        <div class="header-right">
            <button class="header-btn" onclick="backToSite()">‚Üê Back to Site</button>
            <button class="logout-btn header-btn" onclick="handleLogout()">Logout</button>
        </div>
    </header>

    <!-- LEFT NAVIGATION -->
    <nav class="nav-sidebar">
        <ul>
            <li><a href="#" onclick="goToDashboard(); return false;" class="nav-link">Dashboard</a></li>
            <li><a href="all-orders.html" class="nav-link">View Orders</a></li>
            <li><a href="all-customers.html" class="nav-link">View Customers</a></li>
            <li><a href="view-products.html" class="nav-link">View Products</a></li>
            <li><a href="reports.html" class="nav-link">Reports</a></li>
        </ul>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <div class="content">
            <!-- PAGE HEADER -->
            <div class="page-header">
                <h1 class="page-title">Add New Customer</h1>
                <p class="page-subtitle">Create a new customer profile in the system</p>
            </div>

            <!-- SUCCESS/ERROR MESSAGES -->
            <div class="success-message" id="successMessage">
                ‚úÖ Customer created successfully!
            </div>
            <div class="error-message" id="errorMessage">
                ‚ùå Error creating customer. Please check the form and try again.
            </div>

            <!-- FORM CONTAINER -->
            <div class="form-container">
                <form id="newCustomerForm" onsubmit="handleSubmit(event)">

                    <!-- PERSONAL INFORMATION SECTION -->
                    <div class="form-section">
                        <div class="section-title">üë§ Personal Information</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="firstName">First Name <span class="required-indicator">*</span></label>
                                <input type="text" id="firstName" name="firstName" required maxlength="25">
                            </div>

                            <div class="form-group">
                                <label for="middleInit">Middle Initial</label>
                                <input type="text" id="middleInit" name="middleInit" maxlength="1">
                            </div>

                            <div class="form-group">
                                <label for="lastName">Last Name <span class="required-indicator">*</span></label>
                                <input type="text" id="lastName" name="lastName" required maxlength="50">
                            </div>

                            <div class="form-group">
                                <label for="companyName">Company Name</label>
                                <input type="text" id="companyName" name="companyName" maxlength="60">
                            </div>

                            <div class="form-group">
                                <label for="custType">Customer Type <span class="required-indicator">*</span></label>
                                <select id="custType" name="custType" required>
                                    <option value="">-- Select Type --</option>
                                    <option value="1">Retail (Individual)</option>
                                    <option value="2">Corporate (Business)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="custStatus">Customer Status <span class="required-indicator">*</span></label>
                                <select id="custStatus" name="custStatus" required>
                                    <option value="">-- Select Status --</option>
                                    <option value="1">Active</option>
                                    <option value="2">Inactive</option>
                                    <option value="3">Prospect</option>
                                    <option value="4">Do Not Contact</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- ADDRESS INFORMATION SECTION -->
                    <div class="form-section">
                        <div class="section-title">üìç Address Information</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="addrLine1">Address Line 1 <span class="required-indicator">*</span></label>
                                <input type="text" id="addrLine1" name="addrLine1" required maxlength="60">
                            </div>

                            <div class="form-group">
                                <label for="addrLine2">Address Line 2</label>
                                <input type="text" id="addrLine2" name="addrLine2" maxlength="60">
                            </div>

                            <div class="form-group">
                                <label for="state">State / Province <span class="required-indicator">*</span></label>
                                <select id="state" name="state" required>
                                    <option value="">-- Select State --</option>
                                    <option value="TX">Texas</option>
                                    <option value="CA">California</option>
                                    <option value="NY">New York</option>
                                    <option value="FL">Florida</option>
                                    <option value="IL">Illinois</option>
                                    <option value="PA">Pennsylvania</option>
                                    <option value="OH">Ohio</option>
                                    <option value="GA">Georgia</option>
                                    <option value="NC">North Carolina</option>
                                    <option value="MI">Michigan</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="zipCode">Zip Code <span class="required-indicator">*</span></label>
                                <input type="text" id="zipCode" name="zipCode" required maxlength="10" placeholder="00000">
                            </div>

                            <div class="form-group">
                                <label for="country">Country <span class="required-indicator">*</span></label>
                                <select id="country" name="country" required>
                                    <option value="">-- Select Country --</option>
                                    <option value="1" selected>United States</option>
                                    <option value="2">Canada</option>
                                    <option value="3">Mexico</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- CONTACT INFORMATION SECTION -->
                    <div class="form-section">
                        <div class="section-title">üìû Contact Information</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="mobilePhone">Mobile Phone <span class="required-indicator">*</span></label>
                                <input type="tel" id="mobilePhone" name="mobilePhone" required maxlength="20" placeholder="(999) 999-9999">
                                <p class="help-text">Format: (999) 999-9999</p>
                            </div>

                            <div class="form-group">
                                <label for="workPhone">Work Phone</label>
                                <input type="tel" id="workPhone" name="workPhone" maxlength="20" placeholder="(999) 999-9999">
                                <p class="help-text">Format: (999) 999-9999</p>
                            </div>

                            <div class="form-group">
                                <label for="homePhone">Home Phone</label>
                                <input type="tel" id="homePhone" name="homePhone" maxlength="20" placeholder="(999) 999-9999">
                                <p class="help-text">Format: (999) 999-9999</p>
                            </div>

                            <div class="form-group">
                                <label for="email">Email Address <span class="required-indicator">*</span></label>
                                <input type="email" id="email" name="email" required maxlength="40">
                            </div>
                        </div>
                    </div>

                    <!-- ADDITIONAL INFORMATION SECTION -->
                    <div class="form-section">
                        <div class="section-title">üìù Additional Information</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="comments">Comments About Customer</label>
                                <textarea id="comments" name="comments" maxlength="1000" placeholder="Enter any additional notes about this customer..."></textarea>
                                <p class="help-text">Maximum 1000 characters</p>
                            </div>

                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="preferredCustomer" name="preferredCustomer">
                                    <label for="preferredCustomer">Mark as Preferred Customer (Eligible for discounts)</label>
                                </div>
                                <p class="help-text">Preferred customers receive special discounts and priority service</p>
                            </div>
                        </div>
                    </div>

                    <!-- ACTION BUTTONS -->
                    <div class="form-actions form-actions-sticky">
                        <button type="submit" class="btn-submit">‚úÖ Create Customer</button>
                        <button type="reset" class="btn-reset">üîÑ Clear Form</button>
                        <button type="button" class="btn-cancel" onclick="goToCustomers()">‚úï Cancel</button>
                    </div>

                </form>
            </div>

        </div>
    </main>

    <script>
        // Load user info on page load
        window.addEventListener('load', function() {
            loadUserInfo();
        });

        function loadUserInfo() {
            const userRole = localStorage.getItem('userRole') || 'Staff';
            const userName = localStorage.getItem('userName') || 'Guest User';
            document.getElementById('staff-role').textContent = userRole;
            document.getElementById('staff-name').textContent = userName;
        }

        function handleSubmit(event) {
            event.preventDefault();

            // Validate form first
            if (!validateForm('newCustomerForm')) {
                return;
            }

            // Show loading state
            const submitBtn = event.target.querySelector('.btn-submit');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Creating...';

            // Get form data
            const formData = {
                custId: Math.floor(Math.random() * 999999) + 1,
                firstName: document.getElementById('firstName').value,
                middleInit: document.getElementById('middleInit').value,
                lastName: document.getElementById('lastName').value,
                companyName: document.getElementById('companyName').value,
                custType: document.getElementById('custType').value,
                custStatus: document.getElementById('custStatus').value,
                addrLine1: document.getElementById('addrLine1').value,
                addrLine2: document.getElementById('addrLine2').value,
                state: document.getElementById('state').value,
                zipCode: document.getElementById('zipCode').value,
                country: document.getElementById('country').value,
                mobilePhone: document.getElementById('mobilePhone').value,
                workPhone: document.getElementById('workPhone').value,
                homePhone: document.getElementById('homePhone').value,
                email: document.getElementById('email').value,
                comments: document.getElementById('comments').value,
                preferredCustomer: document.getElementById('preferredCustomer').checked ? 'Y' : 'N'
            };

            // Validate required fields
            if (!formData.firstName || !formData.lastName || !formData.custType || !formData.custStatus ||
                !formData.addrLine1 || !formData.state || !formData.zipCode || !formData.country ||
                !formData.mobilePhone || !formData.email) {
                showError('Please fill in all required fields');
                return;
            }

            // Validate phone format
            const phoneRegex = /^[\d\s\-\(\)]+$/;
            if (formData.mobilePhone && !phoneRegex.test(formData.mobilePhone)) {
                showError('Please enter a valid phone number format');
                return;
            }

            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(formData.email)) {
                showError('Please enter a valid email address');
                return;
            }

            // Get existing customers from localStorage
            let customers = JSON.parse(localStorage.getItem('customers') || '[]');

            // Check for duplicate email
            if (customers.some(c => c.email === formData.email)) {
                showError('A customer with this email already exists');
                return;
            }

            // Add new customer
            customers.push(formData);
            localStorage.setItem('customers', JSON.stringify(customers));

            // Show success toast
            showToast(`Customer ${formData.firstName} ${formData.lastName} created successfully!`, 'success');

            // Reset form
            document.getElementById('newCustomerForm').reset();

            // Restore button state
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;

            // Redirect to customers page after 2 seconds
            setTimeout(() => {
                window.location.href = 'all-customers.html';
            }, 2000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = '‚úÖ ' + message;
            successDiv.style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = '‚ùå ' + message;
            errorDiv.style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
        }

        function goToCustomers() {
            if (confirm('Are you sure you want to cancel? Any unsaved changes will be lost.')) {
                window.location.href = 'all-customers.html';
            }
        }

        function backToSite() {
            window.location.href = '../index.html';
        }

        function handleLogout() {
            localStorage.removeItem('userRole');
            localStorage.removeItem('userName');
            window.location.href = '../staff-login.html';
        }
    </script>
    <script src="js/main.js"></script>
</body>
</html>
