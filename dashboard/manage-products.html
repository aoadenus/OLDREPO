<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Products - Emily Bakes Cakes</title>
    <link rel="stylesheet" href="css/dashboard-redesigned.css">
    <style>
        .manage-products-container {
            padding: 30px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            color: #2B2B2B;
            margin-bottom: 10px;
        }

        .page-subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .category-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .category-title {
            font-size: 24px;
            font-weight: 600;
            color: #C44569;
            margin: 0;
        }

        .btn-add {
            background: #C44569;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-add:hover {
            background: #A0355A;
            transform: translateY(-2px);
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
        }

        .items-table th {
            background: #F8EBD7;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #C44569;
        }

        .items-table td {
            padding: 12px;
            border-bottom: 1px solid #E5E7EB;
        }

        .items-table tr:hover {
            background: #F9FAFB;
        }

        .item-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
        }

        .btn-edit, .btn-delete {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            margin-right: 5px;
            transition: all 0.3s;
        }

        .btn-edit {
            background: #3B82F6;
            color: white;
        }

        .btn-edit:hover {
            background: #2563EB;
        }

        .btn-delete {
            background: #EF4444;
            color: white;
        }

        .btn-delete:hover {
            background: #DC2626;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            background: linear-gradient(135deg, #C44569, #A0355A);
            color: white;
            padding: 20px 30px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 24px;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            line-height: 1;
        }

        .modal-body {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2B2B2B;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #C44569;
        }

        .modal-footer {
            padding: 20px 30px;
            background: #F9FAFB;
            border-radius: 0 0 12px 12px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn-cancel, .btn-save {
            padding: 10px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-cancel {
            background: #E5E7EB;
            color: #374151;
        }

        .btn-cancel:hover {
            background: #D1D5DB;
        }

        .btn-save {
            background: #C44569;
            color: white;
        }

        .btn-save:hover {
            background: #A0355A;
        }

        .color-swatch {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            border: 2px solid #E5E7EB;
            display: inline-block;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #9CA3AF;
        }

        .tabs-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            border: 2px solid #E5E7EB;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #C44569;
            color: white;
            border-color: #C44569;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="header-left">
            <div class="header-logo">
                <div class="logo-text">Emily Bakes Cakes</div>
            </div>
        </div>
        <div class="header-center">
            <div class="header-user">
                <div class="role-badge" id="staff-role">Staff</div>
                <div class="manager-name" id="staff-name">Loading...</div>
            </div>
        </div>
        <div class="header-right">
            <button class="header-btn" onclick="backToSite()">‚Üê Back to Site</button>
            <button class="logout-btn header-btn" onclick="handleLogout()">Logout</button>
        </div>
    </header>

    <!-- LEFT NAVIGATION -->
    <nav class="nav-sidebar">
        <ul>
            <li><a href="#" onclick="goToDashboard(); return false;" class="nav-link">Dashboard</a></li>
            <li><a href="all-orders.html" class="nav-link">View Orders</a></li>
            <li><a href="all-customers.html" class="nav-link">View Customers</a></li>
            <li><a href="view-products.html" class="nav-link">View Products</a></li>
            <li><a href="manage-products.html" class="nav-link active">Manage Products</a></li>
            <li><a href="reports.html" class="nav-link">Reports</a></li>
        </ul>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <div class="manage-products-container">
            <h1 class="page-title">Manage Products</h1>
            <p class="page-subtitle">Add, edit, or delete cakes, flavors, decorations, and more</p>

            <!-- Tab Navigation -->
            <div class="tabs-container">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('standard-cakes')">Standard Cakes</button>
                    <button class="tab-btn" onclick="switchTab('cake-flavors')">Cake Flavors</button>
                    <button class="tab-btn" onclick="switchTab('icing-flavors')">Icing Flavors</button>
                    <button class="tab-btn" onclick="switchTab('fillings')">Fillings</button>
                    <button class="tab-btn" onclick="switchTab('icing-colors')">Icing Colors</button>
                    <button class="tab-btn" onclick="switchTab('decorations')">Decorations</button>
                </div>
            </div>

            <!-- Standard Cakes Tab -->
            <div id="standard-cakes" class="tab-content active">
                <div class="category-section">
                    <div class="category-header">
                        <h2 class="category-title">Standard Cakes</h2>
                        <button class="btn-add" onclick="openAddModal('cake')">+ Add New Cake</button>
                    </div>
                    <table class="items-table" id="cakes-table">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Price</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="cakes-tbody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Cake Flavors Tab -->
            <div id="cake-flavors" class="tab-content">
                <div class="category-section">
                    <div class="category-header">
                        <h2 class="category-title">Cake Flavors</h2>
                        <button class="btn-add" onclick="openAddModal('flavor')">+ Add New Flavor</button>
                    </div>
                    <table class="items-table" id="flavors-table">
                        <thead>
                            <tr>
                                <th>Flavor Name</th>
                                <th>Description</th>
                                <th>Price Modifier</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="flavors-tbody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Icing Flavors Tab -->
            <div id="icing-flavors" class="tab-content">
                <div class="category-section">
                    <div class="category-header">
                        <h2 class="category-title">Icing Flavors</h2>
                        <button class="btn-add" onclick="openAddModal('icing')">+ Add New Icing</button>
                    </div>
                    <table class="items-table" id="icing-table">
                        <thead>
                            <tr>
                                <th>Icing Name</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="icing-tbody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Fillings Tab -->
            <div id="fillings" class="tab-content">
                <div class="category-section">
                    <div class="category-header">
                        <h2 class="category-title">Fillings</h2>
                        <button class="btn-add" onclick="openAddModal('filling')">+ Add New Filling</button>
                    </div>
                    <table class="items-table" id="fillings-table">
                        <thead>
                            <tr>
                                <th>Filling Name</th>
                                <th>Description</th>
                                <th>Price</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="fillings-tbody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Icing Colors Tab -->
            <div id="icing-colors" class="tab-content">
                <div class="category-section">
                    <div class="category-header">
                        <h2 class="category-title">Icing Colors</h2>
                        <button class="btn-add" onclick="openAddModal('color')">+ Add New Color</button>
                    </div>
                    <table class="items-table" id="colors-table">
                        <thead>
                            <tr>
                                <th>Color Name</th>
                                <th>Swatch</th>
                                <th>Hex Code</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="colors-tbody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Decorations Tab -->
            <div id="decorations" class="tab-content">
                <div class="category-section">
                    <div class="category-header">
                        <h2 class="category-title">Decorations</h2>
                        <button class="btn-add" onclick="openAddModal('decoration')">+ Add New Decoration</button>
                    </div>
                    <table class="items-table" id="decorations-table">
                        <thead>
                            <tr>
                                <th>Decoration Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="decorations-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal for Add/Edit -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Add Item</h2>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="editForm">
                    <div id="form-fields"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="btn-save" onclick="saveItem()">Save</button>
            </div>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
        // Check if user is manager
        document.addEventListener('DOMContentLoaded', () => {
            const role = localStorage.getItem('staffRole') || '';
            if (role !== 'manager') {
                alert('Access Denied: Manager role required');
                window.location.href = 'manager-dashboard.html';
                return;
            }
            loadUserInfo();
            initializeData();
            renderAll();
        });

        function loadUserInfo() {
            const userName = localStorage.getItem('userName') || 'Manager';
            document.getElementById('staff-name').textContent = userName;
        }

        // Data Storage
        let productsData = {
            standardCakes: [],
            cakeFlavors: [],
            icingFlavors: [],
            fillings: [],
            icingColors: [],
            decorations: []
        };

        let currentEditType = '';
        let currentEditId = null;

        // Initialize data from localStorage or use defaults
        function initializeData() {
            const stored = localStorage.getItem('productsData');
            if (stored) {
                productsData = JSON.parse(stored);
            } else {
                // Initialize with default data
                productsData = {
                    standardCakes: [
                        { id: 1, name: 'Birthday Celebration', description: 'Classic yellow cake with white buttercream', price: 45.00, image: '../public/ebc-cake-images/Birthday.png' },
                        { id: 2, name: 'Almond Delight', description: 'Rich almond cake with almond buttercream', price: 50.00, image: '../public/ebc-cake-images/almondelight.jpg' },
                        { id: 3, name: 'Lemon & Cream Cheese', description: 'Tangy lemon cake with cream cheese icing', price: 48.00, image: '../public/ebc-cake-images/lemoncreamcheese.jpg' },
                        { id: 4, name: 'Black Forest', description: 'Chocolate cake with cherry filling', price: 55.00, image: '../public/ebc-cake-images/blackforest.jpg' },
                        { id: 5, name: 'German Chocolate', description: 'Rich chocolate with pecan praline filling', price: 52.00, image: '../public/ebc-cake-images/germanchocolate.jpg' }
                    ],
                    cakeFlavors: [
                        { id: 1, name: 'Chocolate', description: 'Rich cocoa flavor', priceModifier: 0 },
                        { id: 2, name: 'Vanilla', description: 'Classic vanilla bean', priceModifier: 0 },
                        { id: 3, name: 'Red Velvet', description: 'Southern classic with cocoa', priceModifier: 5 },
                        { id: 4, name: 'Lemon', description: 'Fresh lemon zest', priceModifier: 3 },
                        { id: 5, name: 'Strawberry', description: 'Real strawberry puree', priceModifier: 4 }
                    ],
                    icingFlavors: [
                        { id: 1, name: 'Buttercream', description: 'Classic smooth buttercream' },
                        { id: 2, name: 'Cream Cheese', description: 'Tangy cream cheese frosting' },
                        { id: 3, name: 'Chocolate Ganache', description: 'Rich chocolate ganache' },
                        { id: 4, name: 'Whipped Cream', description: 'Light whipped cream' },
                        { id: 5, name: 'Fondant', description: 'Smooth fondant finish' }
                    ],
                    fillings: [
                        { id: 1, name: 'Raspberry', description: 'Fresh raspberry preserve', price: 8.00 },
                        { id: 2, name: 'Lemon Curd', description: 'Tangy lemon curd', price: 7.00 },
                        { id: 3, name: 'Chocolate Mousse', description: 'Rich chocolate mousse', price: 10.00 },
                        { id: 4, name: 'Strawberry', description: 'Fresh strawberry filling', price: 7.00 },
                        { id: 5, name: 'Bavarian Cream', description: 'Classic bavarian cream', price: 9.00 }
                    ],
                    icingColors: [
                        { id: 1, name: 'White', hex: '#FFFFFF' },
                        { id: 2, name: 'Pink', hex: '#FFB6C1' },
                        { id: 3, name: 'Blue', hex: '#87CEEB' },
                        { id: 4, name: 'Yellow', hex: '#FFD700' },
                        { id: 5, name: 'Purple', hex: '#9370DB' },
                        { id: 6, name: 'Green', hex: '#90EE90' },
                        { id: 7, name: 'Red', hex: '#FF6B6B' }
                    ],
                    decorations: [
                        { id: 1, name: 'Fondant Flowers', category: 'Flowers', price: 15.00 },
                        { id: 2, name: 'Sugar Roses', category: 'Flowers', price: 20.00 },
                        { id: 3, name: 'Edible Pearls', category: 'Embellishments', price: 12.00 },
                        { id: 4, name: 'Gold Leaf', category: 'Embellishments', price: 25.00 },
                        { id: 5, name: 'Chocolate Curls', category: 'Chocolate', price: 10.00 }
                    ]
                };
                saveData();
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('productsData', JSON.stringify(productsData));
        }

        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Render Functions
        function renderAll() {
            renderCakes();
            renderFlavors();
            renderIcings();
            renderFillings();
            renderColors();
            renderDecorations();
        }

        function renderCakes() {
            const tbody = document.getElementById('cakes-tbody');
            tbody.innerHTML = productsData.standardCakes.map(cake => `
                <tr>
                    <td><img src="${cake.image}" class="item-image" alt="${cake.name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'60\\' height=\\'60\\'%3E%3Crect fill=\\'%23f0f0f0\\' width=\\'60\\' height=\\'60\\'/%3E%3Ctext x=\\'50%25\\' y=\\'50%25\\' dominant-baseline=\\'middle\\' text-anchor=\\'middle\\' font-size=\\'30\\'%3Eüç∞%3C/text%3E%3C/svg%3E'"></td>
                    <td><strong>${cake.name}</strong></td>
                    <td>${cake.description}</td>
                    <td>$${cake.price.toFixed(2)}</td>
                    <td>
                        <button class="btn-edit" onclick="editItem('cake', ${cake.id})">Edit</button>
                        <button class="btn-delete" onclick="deleteItem('cake', ${cake.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function renderFlavors() {
            const tbody = document.getElementById('flavors-tbody');
            tbody.innerHTML = productsData.cakeFlavors.map(flavor => `
                <tr>
                    <td><strong>${flavor.name}</strong></td>
                    <td>${flavor.description}</td>
                    <td>$${flavor.priceModifier.toFixed(2)}</td>
                    <td>
                        <button class="btn-edit" onclick="editItem('flavor', ${flavor.id})">Edit</button>
                        <button class="btn-delete" onclick="deleteItem('flavor', ${flavor.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function renderIcings() {
            const tbody = document.getElementById('icing-tbody');
            tbody.innerHTML = productsData.icingFlavors.map(icing => `
                <tr>
                    <td><strong>${icing.name}</strong></td>
                    <td>${icing.description}</td>
                    <td>
                        <button class="btn-edit" onclick="editItem('icing', ${icing.id})">Edit</button>
                        <button class="btn-delete" onclick="deleteItem('icing', ${icing.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function renderFillings() {
            const tbody = document.getElementById('fillings-tbody');
            tbody.innerHTML = productsData.fillings.map(filling => `
                <tr>
                    <td><strong>${filling.name}</strong></td>
                    <td>${filling.description}</td>
                    <td>$${filling.price.toFixed(2)}</td>
                    <td>
                        <button class="btn-edit" onclick="editItem('filling', ${filling.id})">Edit</button>
                        <button class="btn-delete" onclick="deleteItem('filling', ${filling.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function renderColors() {
            const tbody = document.getElementById('colors-tbody');
            tbody.innerHTML = productsData.icingColors.map(color => `
                <tr>
                    <td><strong>${color.name}</strong></td>
                    <td><div class="color-swatch" style="background-color: ${color.hex};"></div></td>
                    <td>${color.hex}</td>
                    <td>
                        <button class="btn-edit" onclick="editItem('color', ${color.id})">Edit</button>
                        <button class="btn-delete" onclick="deleteItem('color', ${color.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function renderDecorations() {
            const tbody = document.getElementById('decorations-tbody');
            tbody.innerHTML = productsData.decorations.map(decoration => `
                <tr>
                    <td><strong>${decoration.name}</strong></td>
                    <td>${decoration.category}</td>
                    <td>$${decoration.price.toFixed(2)}</td>
                    <td>
                        <button class="btn-edit" onclick="editItem('decoration', ${decoration.id})">Edit</button>
                        <button class="btn-delete" onclick="deleteItem('decoration', ${decoration.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        // Modal Functions
        function openAddModal(type) {
            currentEditType = type;
            currentEditId = null;
            
            const titles = {
                cake: 'Add New Standard Cake',
                flavor: 'Add New Cake Flavor',
                icing: 'Add New Icing Flavor',
                filling: 'Add New Filling',
                color: 'Add New Icing Color',
                decoration: 'Add New Decoration'
            };
            
            document.getElementById('modal-title').textContent = titles[type];
            generateFormFields(type);
            document.getElementById('editModal').classList.add('active');
        }

        function editItem(type, id) {
            currentEditType = type;
            currentEditId = id;
            
            const titles = {
                cake: 'Edit Standard Cake',
                flavor: 'Edit Cake Flavor',
                icing: 'Edit Icing Flavor',
                filling: 'Edit Filling',
                color: 'Edit Icing Color',
                decoration: 'Edit Decoration'
            };
            
            document.getElementById('modal-title').textContent = titles[type];
            generateFormFields(type, id);
            document.getElementById('editModal').classList.add('active');
        }

        function generateFormFields(type, id = null) {
            const formFields = document.getElementById('form-fields');
            let item = null;
            
            if (id) {
                const dataKey = {
                    cake: 'standardCakes',
                    flavor: 'cakeFlavors',
                    icing: 'icingFlavors',
                    filling: 'fillings',
                    color: 'icingColors',
                    decoration: 'decorations'
                };
                item = productsData[dataKey[type]].find(i => i.id === id);
            }
            
            let fields = '';
            
            switch(type) {
                case 'cake':
                    fields = `
                        <div class="form-group">
                            <label class="form-label">Cake Name</label>
                            <input type="text" id="field-name" class="form-input" value="${item?.name || ''}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea id="field-description" class="form-textarea" required>${item?.description || ''}</textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Price</label>
                            <input type="number" id="field-price" class="form-input" step="0.01" value="${item?.price || ''}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Image URL</label>
                            <input type="text" id="field-image" class="form-input" value="${item?.image || ''}" placeholder="../public/ebc-cake-images/...">
                        </div>
                    `;
                    break;
                case 'flavor':
                    fields = `
                        <div class="form-group">
                            <label class="form-label">Flavor Name</label>
                            <input type="text" id="field-name" class="form-input" value="${item?.name || ''}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea id="field-description" class="form-textarea" required>${item?.description || ''}</textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Price Modifier</label>
                            <input type="number" id="field-priceModifier" class="form-input" step="0.01" value="${item?.priceModifier || 0}" required>
                        </div>
                    `;
                    break;
                case 'icing':
                    fields = `
                        <div class="form-group">
                            <label class="form-label">Icing Name</label>
                            <input type="text" id="field-name" class="form-input" value="${item?.name || ''}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea id="field-description" class="form-textarea" required>${item?.description || ''}</textarea>
                        </div>
                    `;
                    break;
                case 'filling':
                    fields = `
                        <div class="form-group">
                            <label class="form-label">Filling Name</label>
                            <input type="text" id="field-name" class="form-input" value="${item?.name || ''}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea id="field-description" class="form-textarea" required>${item?.description || ''}</textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Price</label>
                            <input type="number" id="field-price" class="form-input" step="0.01" value="${item?.price || ''}" required>
                        </div>
                    `;
                    break;
                case 'color':
                    fields = `
                        <div class="form-group">
                            <label class="form-label">Color Name</label>
                            <input type="text" id="field-name" class="form-input" value="${item?.name || ''}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Hex Code</label>
                            <input type="color" id="field-hex" class="form-input" value="${item?.hex || '#FFFFFF'}" required>
                        </div>
                    `;
                    break;
                case 'decoration':
                    fields = `
                        <div class="form-group">
                            <label class="form-label">Decoration Name</label>
                            <input type="text" id="field-name" class="form-input" value="${item?.name || ''}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <input type="text" id="field-category" class="form-input" value="${item?.category || ''}" placeholder="e.g., Flowers, Embellishments, Chocolate" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Price</label>
                            <input type="number" id="field-price" class="form-input" step="0.01" value="${item?.price || ''}" required>
                        </div>
                    `;
                    break;
            }
            
            formFields.innerHTML = fields;
        }

        function saveItem() {
            const dataKey = {
                cake: 'standardCakes',
                flavor: 'cakeFlavors',
                icing: 'icingFlavors',
                filling: 'fillings',
                color: 'icingColors',
                decoration: 'decorations'
            };
            
            const key = dataKey[currentEditType];
            let itemData = {};
            
            // Collect form data based on type
            switch(currentEditType) {
                case 'cake':
                    itemData = {
                        name: document.getElementById('field-name').value,
                        description: document.getElementById('field-description').value,
                        price: parseFloat(document.getElementById('field-price').value),
                        image: document.getElementById('field-image').value
                    };
                    break;
                case 'flavor':
                    itemData = {
                        name: document.getElementById('field-name').value,
                        description: document.getElementById('field-description').value,
                        priceModifier: parseFloat(document.getElementById('field-priceModifier').value)
                    };
                    break;
                case 'icing':
                    itemData = {
                        name: document.getElementById('field-name').value,
                        description: document.getElementById('field-description').value
                    };
                    break;
                case 'filling':
                    itemData = {
                        name: document.getElementById('field-name').value,
                        description: document.getElementById('field-description').value,
                        price: parseFloat(document.getElementById('field-price').value)
                    };
                    break;
                case 'color':
                    itemData = {
                        name: document.getElementById('field-name').value,
                        hex: document.getElementById('field-hex').value
                    };
                    break;
                case 'decoration':
                    itemData = {
                        name: document.getElementById('field-name').value,
                        category: document.getElementById('field-category').value,
                        price: parseFloat(document.getElementById('field-price').value)
                    };
                    break;
            }
            
            if (currentEditId) {
                // Update existing item
                const index = productsData[key].findIndex(i => i.id === currentEditId);
                productsData[key][index] = { ...productsData[key][index], ...itemData };
            } else {
                // Add new item
                const newId = Math.max(...productsData[key].map(i => i.id), 0) + 1;
                productsData[key].push({ id: newId, ...itemData });
            }
            
            saveData();
            renderAll();
            closeModal();
        }

        function deleteItem(type, id) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            
            const dataKey = {
                cake: 'standardCakes',
                flavor: 'cakeFlavors',
                icing: 'icingFlavors',
                filling: 'fillings',
                color: 'icingColors',
                decoration: 'decorations'
            };
            
            const key = dataKey[type];
            productsData[key] = productsData[key].filter(item => item.id !== id);
            
            saveData();
            renderAll();
        }

        function closeModal() {
            document.getElementById('editModal').classList.remove('active');
        }

        function backToSite() {
            window.location.href = '../index.html';
        }

        function handleLogout() {
            localStorage.removeItem('staffRole');
            localStorage.removeItem('staffUser');
            window.location.href = '../staff-login.html';
        }

        // Close modal on outside click
        document.getElementById('editModal').addEventListener('click', (e) => {
            if (e.target.id === 'editModal') {
                closeModal();
            }
        });
    </script>
</body>
</html>
